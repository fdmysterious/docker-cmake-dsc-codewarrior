/***********************************************************************************************************************
 * This file was generated by the MCUXpresso Config Tools. Any manual edits made to this file
 * will be overwritten if the respective MCUXpresso Config Tools is used to update this file.
 **********************************************************************************************************************/
/*
 * Clock initialization functions.
 */

/* clang-format off */
/* TEXT BELOW IS USED AS SETTING FOR TOOLS *************************************
!!GlobalInfo
product: Clocks v9.0
processor: MC56F83789
package_id: MC56F83789VLL
mcu_data: ksdk2_0
processor_version: 11.0.1
board: MC56F83000-EVK
 * BE CAREFUL MODIFYING THIS COMMENT - IT IS YAML SETTINGS FOR TOOLS **********/
/* clang-format on */

#include "fsl_clock.h"
#include "clock_config.h"

/*******************************************************************************
 * Definitions
 ******************************************************************************/

/*******************************************************************************
 * Variables
 ******************************************************************************/

/*******************************************************************************
 ************************ BOARD_InitBootClocks function ************************
 ******************************************************************************/
void BOARD_InitBootClocks(void)
{
    BOARD_BootClockRUN();
}

/*******************************************************************************
 ********************** Configuration BOARD_BootClockRUN ***********************
 ******************************************************************************/
/* clang-format off */
/* TEXT BELOW IS USED AS SETTING FOR TOOLS *************************************
!!Configuration
name: BOARD_BootClockRUN
called_from_default_init: true
outputs:
- {id: BUS_2X_CLK.outFreq, value: 200 MHz}
- {id: BUS_CLK.outFreq, value: 100 MHz}
- {id: CPU_CLK.outFreq, value: 100 MHz}
- {id: EXT_CLK.outFreq, value: 8 MHz}
- {id: IIC0_FLT_CLK.outFreq, value: 100 MHz}
- {id: IIC1_FLT_CLK.outFreq, value: 100 MHz}
- {id: MSTR_OSC.outFreq, value: 8 MHz}
- {id: ROSC200kHz_CLK.outFreq, value: 200 kHz}
- {id: ROSC48MHz_CLK.outFreq, value: 48 MHz}
- {id: ROSC8MHz_CLK.outFreq, value: 8 MHz}
- {id: SCI0_CLK.outFreq, value: 100 MHz}
- {id: SCI1_CLK.outFreq, value: 100 MHz}
- {id: SCI2_CLK.outFreq, value: 100 MHz}
- {id: SYS_2X_CLK.outFreq, value: 200 MHz}
- {id: SYS_CLK.outFreq, value: 100 MHz}
- {id: SYS_FTFE.outFreq, value: 25 MHz}
- {id: SYS_IPBB.outFreq, value: 100 MHz}
- {id: XOSC_CLK.outFreq, value: 8 MHz}
settings:
- {id: OCCS.COD.scale, value: '1', locked: true}
- {id: OCCS.EXT_SEL.sel, value: OCCS.OSC}
- {id: OCCS.PRECS.sel, value: OCCS.EXT_SEL}
- {id: OCCS.ZSRC.sel, value: OCCS.PLL_DIV2}
- {id: OCCS_CTRL_PLLPD_CFG, value: Enabled}
- {id: OCCS_OSCTL2_COPD_CFG, value: Enabled}
- {id: OCCS_OSCTL2_MON_ENABLE_CFG, value: Enabled}
- {id: OCCS_OSCTL2_ROPD200K_CFG, value: Enabled}
sources:
- {id: OCCS.OSC.outFreq, value: 8 MHz, enabled: true}
- {id: OCCS.ROSC200kHz.outFreq, value: 200 kHz}
 * BE CAREFUL MODIFYING THIS COMMENT - IT IS YAML SETTINGS FOR TOOLS **********/
/* clang-format on */

/*******************************************************************************
 * Variables for BOARD_BootClockRUN configuration
 ******************************************************************************/
clock_config_t occsConfig_BOARD_BootClockRUN =
    {
        .bCrystalOscEnable = true,                /* Crystal oscillator is enabled */
        .bFircEnable = true,                      /* RC oscillator 48 MHz is enabled */
        .bSircEnable = true,                      /* RC oscillator 200 kHz is enabled */
        .bPllEnable = true,                       /* PLL is enabled */
        .bCrystalOscMonitorEnable = true,         /* External crystal (XOSC) clock monitor is enabled. */
        .eCrystalOscMode = kCLOCK_CrystalOscModeFSP,/* High power mode of the external oscillator (crystal oscillator in in Full Swing Pierce (FSP) mode) */
        .eExtClkSrc = kCLOCK_ExtClkSrcCrystalOsc, /* External crystal oscillator (OSC) */
        .eClkInSel = kCLOCK_SelClkIn0,            /* External reference clock CLKIN0 */
        .eMstrOscClkSrc = kCLOCK_MstrOscClkSrcExt,/* External reference clock */
        .eMstr2xClkSrc = kCLOCK_Mstr2xClkSrcPllDiv2,/* PLL output clock divided by 2 */
        .eMstr2xClkPostScale = kCLOCK_PostscaleDiv1,/* mast_2x_clk = clkSrc / 1 */
        .u32PllClkFreq = 400000000U,              /* PLL output frequency: 400000000Hz */
    };

/*******************************************************************************
 * Code for BOARD_BootClockRUN configuration
 ******************************************************************************/
void BOARD_BootClockRUN(void)
{
    /* Check the run mode - switch all power regulators in the normal mode if they are placed in standby or disabled mode. */
    /* If the advanced power mode is enabled in the Flash Options register. */
    if (FTFE->FOPT & 0x1) {
        /* If the Very Low Power Run mode is active. */
        if (SIM->PWRMODE & SIM_PWRMODE_VLPMS_MASK) {
            SIM->PWRMODE &= ~SIM_PWRMODE_VLPMODE_MASK;
            while (SIM->PWRMODE & SIM_PWRMODE_VLPMS_MASK){} /* Waiting to switch back from the Very Low Power Run mode. */
        }
        /* If the Low Power Run mode is active. */
        if (SIM->PWRMODE & SIM_PWRMODE_LPMS_MASK) {
            SIM->PWRMODE &= ~SIM_PWRMODE_LPMODE_MASK;
            while (SIM->PWRMODE & SIM_PWRMODE_LPMS_MASK) {} /* Waiting to switch back from the Low Power Run mode. */
        }
        while (!(PMC->STS & PMC_STS_SR27_MASK)) {} /* Waiting for small regulator 2.7V supply is ready to be used. */
    } else {
        /* If a standby or power down state of any regulator is activated. */
        if (SIM->PWR & (SIM_PWR_SR12STDBY_MASK | SIM_PWR_SR27PDN_MASK | SIM_PWR_SR27STDBY_MASK | SIM_PWR_LRSTDBY_MASK)) {
            SIM->PWR = 0; /* Enter the run mode - switch all power regulators into the normal mode. */
             while (!(PMC->STS & PMC_STS_SR27_MASK)) {} /* Waiting for small regulator 2.7V supply is ready to be used. */
        }
    }
    /* Set the frequency of the external crystal oscillator. */
    CLOCK_SetXtalFreq(BOARD_XTAL_CLK_HZ);
    /* Set clock configuration of the OCCS module. */
    CLOCK_SetClkConfig(&occsConfig_BOARD_BootClockRUN);
}

/*******************************************************************************
 ********************* Configuration BOARD_BootClockLPRUN **********************
 ******************************************************************************/
/* clang-format off */
/* TEXT BELOW IS USED AS SETTING FOR TOOLS *************************************
!!Configuration
name: BOARD_BootClockLPRUN
outputs:
- {id: BUS_2X_CLK.outFreq, value: 4 MHz}
- {id: BUS_CLK.outFreq, value: 2 MHz}
- {id: CPU_CLK.outFreq, value: 2 MHz}
- {id: EXT_CLK.outFreq, value: 8 MHz}
- {id: IIC0_FLT_CLK.outFreq, value: 2 MHz}
- {id: IIC1_FLT_CLK.outFreq, value: 2 MHz}
- {id: MSTR_OSC.outFreq, value: 8 MHz}
- {id: ROSC200kHz_CLK.outFreq, value: 200 kHz}
- {id: ROSC48MHz_CLK.outFreq, value: 48 MHz}
- {id: ROSC8MHz_CLK.outFreq, value: 8 MHz}
- {id: SCI0_CLK.outFreq, value: 2 MHz}
- {id: SCI1_CLK.outFreq, value: 2 MHz}
- {id: SCI2_CLK.outFreq, value: 2 MHz}
- {id: SYS_2X_CLK.outFreq, value: 4 MHz}
- {id: SYS_CLK.outFreq, value: 2 MHz}
- {id: SYS_FTFE.outFreq, value: 500 kHz}
- {id: SYS_IPBB.outFreq, value: 2 MHz}
- {id: XOSC_CLK.outFreq, value: 8 MHz}
settings:
- {id: powerMode, value: LPRUN}
- {id: OCCS.COD.scale, value: '2', locked: true}
- {id: OCCS.EXT_SEL.sel, value: OCCS.OSC}
- {id: OCCS.PRECS.sel, value: OCCS.EXT_SEL}
- {id: OCCS_OSCTL2_COPD_CFG, value: Enabled}
- {id: OCCS_OSCTL2_MON_ENABLE_CFG, value: Enabled}
- {id: OCCS_OSCTL2_ROPD200K_CFG, value: Enabled}
sources:
- {id: OCCS.OSC.outFreq, value: 8 MHz, enabled: true}
- {id: OCCS.ROSC200kHz.outFreq, value: 200 kHz}
 * BE CAREFUL MODIFYING THIS COMMENT - IT IS YAML SETTINGS FOR TOOLS **********/
/* clang-format on */

/*******************************************************************************
 * Variables for BOARD_BootClockLPRUN configuration
 ******************************************************************************/
clock_config_t occsConfig_BOARD_BootClockLPRUN =
    {
        .bCrystalOscEnable = true,                /* Crystal oscillator is enabled */
        .bFircEnable = true,                      /* RC oscillator 48 MHz is enabled */
        .bSircEnable = true,                      /* RC oscillator 200 kHz is enabled */
        .bPllEnable = false,                      /* PLL is disabled */
        .bCrystalOscMonitorEnable = true,         /* External crystal (XOSC) clock monitor is enabled. */
        .eCrystalOscMode = kCLOCK_CrystalOscModeFSP,/* High power mode of the external oscillator (crystal oscillator in in Full Swing Pierce (FSP) mode) */
        .eExtClkSrc = kCLOCK_ExtClkSrcCrystalOsc, /* External crystal oscillator (OSC) */
        .eClkInSel = kCLOCK_SelClkIn0,            /* External reference clock CLKIN0 */
        .eMstrOscClkSrc = kCLOCK_MstrOscClkSrcExt,/* External reference clock */
        .eMstr2xClkSrc = kCLOCK_Mstr2xClkSrcMstrOsc,/* MSTR_OSC clock from the prescaler selector */
        .eMstr2xClkPostScale = kCLOCK_PostscaleDiv2,/* mast_2x_clk = clkSrc / 2 */
        .u32PllClkFreq = 0U,                      /* PLL output frequency: 0Hz */
    };

/*******************************************************************************
 * Code for BOARD_BootClockLPRUN configuration
 ******************************************************************************/
void BOARD_BootClockLPRUN(void)
{
    /* Check the run mode - switch all power regulators in the normal mode if they are placed in standby or disabled mode. */
    /* If the advanced power mode is enabled in the Flash Options register. */
    if (FTFE->FOPT & 0x1) {
        /* If the Very Low Power Run mode is active. */
        if (SIM->PWRMODE & SIM_PWRMODE_VLPMS_MASK) {
            SIM->PWRMODE &= ~SIM_PWRMODE_VLPMODE_MASK;
            while (SIM->PWRMODE & SIM_PWRMODE_VLPMS_MASK){} /* Waiting to switch back from the Very Low Power Run mode. */
        }
        /* If the Low Power Run mode is active. */
        if (SIM->PWRMODE & SIM_PWRMODE_LPMS_MASK) {
            SIM->PWRMODE &= ~SIM_PWRMODE_LPMODE_MASK;
            while (SIM->PWRMODE & SIM_PWRMODE_LPMS_MASK) {} /* Waiting to switch back from the Low Power Run mode. */
        }
        while (!(PMC->STS & PMC_STS_SR27_MASK)) {} /* Waiting for small regulator 2.7V supply is ready to be used. */
    } else {
        /* If a standby or power down state of any regulator is activated. */
        if (SIM->PWR & (SIM_PWR_SR12STDBY_MASK | SIM_PWR_SR27PDN_MASK | SIM_PWR_SR27STDBY_MASK | SIM_PWR_LRSTDBY_MASK)) {
            SIM->PWR = 0; /* Enter the run mode - switch all power regulators into the normal mode. */
             while (!(PMC->STS & PMC_STS_SR27_MASK)) {} /* Waiting for small regulator 2.7V supply is ready to be used. */
        }
    }
    /* Set the frequency of the external crystal oscillator. */
    CLOCK_SetXtalFreq(BOARD_XTAL_CLK_HZ);
    /* Set clock configuration of the OCCS module. */
    CLOCK_SetClkConfig(&occsConfig_BOARD_BootClockLPRUN);
    /* Set the Low Power Run mode. */
    /* If the advanced power mode is enabled in the Flash Options register. */
    if (FTFE->FOPT & 0x1) {
        SIM->PWRMODE |= SIM_PWRMODE_LPMODE_MASK;
        while (!(SIM->PWRMODE & SIM_PWRMODE_LPMS_MASK)){ /* Waiting to switch in the low power mode. */ }
    } else {
        SIM->PWR |= SIM_PWR_SR12STDBY(1) | SIM_PWR_SR27STDBY(1) | SIM_PWR_LRSTDBY(1);
    }
}

